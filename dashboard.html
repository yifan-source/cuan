<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Cuan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0b0f1a; --card: #151c2c; --primary: #4a8d88; --text-dim: #94a3b8; }
        body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: white; padding-bottom: 90px; }

        .top-bar { padding: 25px 5%; display: flex; justify-content: space-between; align-items: center; }
        .user-info h2 { margin: 0; font-size: 18px; font-weight: 800; }
        .notif-btn { position: relative; width: 45px; height: 45px; background: var(--card); border-radius: 15px; display: flex; align-items: center; justify-content: center; text-decoration: none; color: white; border: 1px solid rgba(255,255,255,0.05); }
        #notifDot { position: absolute; top: 12px; right: 12px; width: 9px; height: 9px; background: #ff4757; border-radius: 50%; border: 2px solid var(--bg); display: none; }

        .wallet-card { margin: 0 5% 25px; padding: 25px; background: linear-gradient(135deg, #4a8d88 0%, #2a5250 100%); border-radius: 28px; box-shadow: 0 15px 30px rgba(74, 141, 136, 0.2); }
        .wallet-card h1 { margin: 8px 0 20px; font-size: 32px; font-weight: 800; }
        .wallet-actions { display: flex; gap: 10px; }
        .btn-wallet { flex: 1; padding: 12px; border-radius: 15px; background: rgba(255,255,255,0.15); color: white; font-weight: 800; font-size: 12px; text-decoration: none; text-align: center; border: 1px solid rgba(255,255,255,0.1); }

        .section-label { padding: 0 6%; font-size: 12px; font-weight: 800; margin: 25px 0 15px; color: var(--primary); letter-spacing: 1px; display: flex; justify-content: space-between; }
        
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 0 5%; }
        .menu-item { background: var(--card); padding: 20px 10px; border-radius: 22px; border: 1px solid rgba(255,255,255,0.03); text-decoration: none; color: white; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .menu-item i { font-size: 24px; color: var(--primary); margin-bottom: 10px; }
        .menu-item span { font-size: 13px; font-weight: 700; }

        /* Task Preview List */
        .preview-list { padding: 0 5%; }
        .preview-item { background: var(--card); padding: 15px; border-radius: 18px; display: flex; align-items: center; gap: 15px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.03); }
        .task-icon { width: 45px; height: 45px; background: #1e293b; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--primary); }
        .task-info { flex: 1; }
        .task-info b { font-size: 14px; display: block; margin-bottom: 2px; }
        .task-info small { color: #22c55e; font-weight: 700; }
        .btn-go { background: var(--primary); color: white; padding: 8px 15px; border-radius: 10px; font-size: 11px; font-weight: 800; text-decoration: none; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; background: rgba(21, 28, 44, 0.95); display: flex; justify-content: space-around; padding: 18px 0; backdrop-filter: blur(20px); border-top: 1px solid rgba(255,255,255,0.05); }
        .nav-item { text-decoration: none; color: var(--text-dim); text-align: center; flex: 1; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }
        .nav-item span { font-size: 10px; font-weight: 700; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="user-info">
            <p style="margin:0; font-size:12px; color:var(--text-dim);">Halo,</p>
            <h2 id="userName">Memuat...</h2>
        </div>
        <a href="notifications.html" class="notif-btn">
            <i class="fa-solid fa-bell"></i>
            <span id="notifDot"></span>
        </a>
    </div>

    <div class="wallet-card">
        <small>SALDO SAYA</small>
        <h1 id="userBalance">Rp 0</h1>
        <div class="wallet-actions">
            <a href="withdraw.html" class="btn-wallet">Tarik Tunai</a>
            <a href="deposit.html" class="btn-wallet">Top Up</a>
        </div>
    </div>

    <p class="section-label">MENU & FITUR</p>
    <div class="menu-grid">
    <a href="task.html" class="menu-item">
        <i class="fa-solid fa-layer-group"></i>
        <span>Tugas</span>
    </a>

    <a href="leaderboard.html" class="menu-item">
        <i class="fa-solid fa-trophy"></i>
        <span>Leaderboard</span>
    </a>

    <a href="withdraw.html" class="menu-item">
        <i class="fa-solid fa-wallet"></i>
        <span>Penarikan</span>
    </a>

    <a href="deposit.html" class="menu-item">
        <i class="fa-solid fa-money-bill-transfer"></i>
        <span>Deposit</span>
    </a>

    <a href="referral.html" class="menu-item">
        <i class="fa-solid fa-user-plus"></i>
        <span>Referral</span>
    </a>

    <a href="history.html" class="menu-item">
        <i class="fa-solid fa-clock-rotate-left"></i>
        <span>Riwayat</span>
    </a>

    <a href="create-task.html" class="menu-item">
        <i class="fa-solid fa-bullhorn"></i>
        <span>Pasang Iklan</span>
    </a>

    <a href="profile.html" class="menu-item">
        <i class="fa-solid fa-user-gear"></i>
        <span>Pengaturan</span>
    </a>
</div>
    <section style="margin: 45px 6% 30px; padding-top: 25px; border-top: 1px solid rgba(255,255,255,0.05);">
    
    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 25px;">
        <div style="width: 15px; height: 2px; background: var(--primary);"></div>
        <span style="font-size: 10px; font-weight: 800; color: var(--text-dim); letter-spacing: 2px; text-transform: uppercase;">Platform Statistics</span>
    </div>

    <div style="display: flex; flex-direction: column; gap: 20px;">
        
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="width: 42px; height: 42px; border-radius: 12px; background: rgba(34, 197, 94, 0.1); display: flex; align-items: center; justify-content: center;">
                    <i class="fa-solid fa-money-bill-transfer" style="color: #22c55e; font-size: 18px;"></i>
                </div>
                <div>
                    <span style="display: block; font-size: 9px; font-weight: 700; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px;">Total Penarikan</span>
                    <b style="font-size: 17px; color: white; letter-spacing: 0.5px;">Rp 14.5jt<span style="color: #22c55e; margin-left: 2px;">+</span></b>
                </div>
            </div>
            <div style="text-align: right;">
                <span style="display: block; font-size: 9px; color: #22c55e; font-weight: 800;"><i class="fa-solid fa-caret-up"></i> 46.2%</span>
                <span style="font-size: 8px; color: var(--text-dim);">Hari ini</span>
            </div>
        </div>

        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="width: 42px; height: 42px; border-radius: 12px; background: rgba(74, 141, 136, 0.1); display: flex; align-items: center; justify-content: center;">
                    <i class="fa-solid fa-users-viewfinder" style="color: var(--primary); font-size: 18px;"></i>
                </div>
                <div>
                    <span style="display: block; font-size: 9px; font-weight: 700; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px;">Member Aktif</span>
                    <b style="font-size: 17px; color: white; letter-spacing: 0.5px;">18.9rb<span style="color: var(--primary); margin-left: 2px;">+</span></b>
                </div>
            </div>
            <div style="text-align: right;">
                <span style="display: block; font-size: 9px; color: var(--primary); font-weight: 800;"><i class="fa-solid fa-chart-line"></i> Global</span>
            </div>
        </div>

        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="width: 42px; height: 42px; border-radius: 12px; background: rgba(99, 102, 241, 0.1); display: flex; align-items: center; justify-content: center;">
                    <i class="fa-solid fa-list-check" style="color: #6366f1; font-size: 18px;"></i>
                </div>
                <div>
                    <span style="display: block; font-size: 9px; font-weight: 700; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px;">Task Dikerjakan</span>
                    <b style="font-size: 17px; color: white; letter-spacing: 0.5px;">29.8rb<span style="color: #6366f1; margin-left: 2px;">+</span></b>
                </div>
            </div>
            <div style="text-align: right;">
                <span style="display: block; font-size: 9px; color: #6366f1; font-weight: 800;">LIVE</span>
                <span style="display: inline-block; width: 6px; height: 6px; background: #6366f1; border-radius: 50%; animation: pulse 1.5s infinite;"></span>
            </div>
        </div>

    </div>
</section>

<style>
@keyframes pulse {
    0% { transform: scale(0.95); opacity: 0.7; }
    50% { transform: scale(1.2); opacity: 1; }
    100% { transform: scale(0.95); opacity: 0.7; }
}
</style>
    <footer style="margin-top: 20px; padding: 40px 6%; background: rgba(255,255,255,0.02); border-top: 1px solid rgba(255,255,255,0.05); text-align: center;">
    
    <div style="margin-bottom: 20px;">
        <img src="img/logo.jpg" alt="Logo" style="width: 50px; height: 50px; border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--primary);">
        <div style="font-size: 16px; font-weight: 800; letter-spacing: 2px;">Bonus<span style="color: var(--primary);">Cuan</span></div>
    </div>

    <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 25px;">
        <a href="tos.html" style="color: var(--primary); font-size: 12px; font-weight: 600; text-decoration: none; border: 1px solid var(--primary); padding: 5px 15px; border-radius: 20px;">Syarat & Ketentuan</a>
        <a href="privacy.html" style="color: var(--primary); font-size: 12px; font-weight: 600; text-decoration: none; border: 1px solid var(--primary); padding: 5px 15px; border-radius: 20px;">Kebijakan Privasi</a>
    </div>

    <p style="font-size: 11px; color: var(--text-dim); line-height: 1.8; max-width: 400px; margin: 0 auto;">
        Â© 2025-2026 Cuan Technology. All Rights Reserved.<br>
        Platform Periklanan Digital & Marketplace Berlisensi.<br>
        <span style="opacity: 0.4;">Server: cuan.js | Encrypted by Google Firebase</span>
    </p>
</div>
</footer>

    <style>
        .nav-bar { 
            position: fixed; 
            bottom: 0; 
            width: 100%; 
            background: rgba(21, 28, 44, 0.98); 
            display: flex; 
            justify-content: space-around; 
            padding: 12px 0 25px; 
            backdrop-filter: blur(20px); 
            border-top: 1px solid rgba(255,255,255,0.05); 
            z-index: 9999;
        }
        .nav-item { 
            text-decoration: none; 
            color: #94a3b8; 
            text-align: center; 
            flex: 1; 
            transition: 0.3s;
        }
        .nav-item.active { 
            color: #4a8d88; 
        }
        .nav-item i { 
            font-size: 20px; 
            display: block; 
            margin-bottom: 4px; 
        }
        .nav-item span { 
            font-size: 10px; 
            font-weight: 800; 
            display: block;
            text-transform: uppercase;
        }
    </style>

    <nav class="nav-bar">
        <a href="dashboard.html" class="nav-item active">
            <i class="fa-solid fa-house"></i>
            <span>HOME</span>
        </a>
        <a href="withdraw.html" class="nav-item">
            <i class="fa-solid fa-wallet"></i>
            <span>PENARIKAN</span>
        </a>
        <a href="referral.html" class="nav-item">
            <i class="fa-solid fa-user-plus"></i>
            <span>UNDANG</span>
        </a>
        <a href="profile.html" class="nav-item">
            <i class="fa-solid fa-circle-user"></i>
            <span>PROFIL</span>
        </a>
    </nav>
        <script type="module">
    // Ini import variabel dari file config Boss
    import { db, auth } from './js/firebase-config.js';

    // Ini import PERINTAH AKSI dari library Firebase langsung
    import { 
        doc, 
        onSnapshot, 
        collection, 
        query, 
        limit, 
        getDoc,    // <--- WAJIB TAMBAH INI
        updateDoc  // <--- TAMBAH INI JUGA biar bisa ngedit data
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    
    // ... sisa kode Boss ke bawah ...

auth.onAuthStateChanged(async user => {
    if(user) {
        const s = await getDoc(doc(db, "users", user.uid));
        if(s.exists()){
            // JIKA STATUS USER ADALAH 'BANNED'
            if(s.data().status === 'banned') {
                window.location.href = "banned.html";
                return;
            }
            // Lanjut ke dashboard...
        }
    } else { window.location.href = "login.html"; }
});

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Load Profil & Saldo
                onSnapshot(doc(db, "users", user.uid), (s) => {
                    if(s.exists()){
                        document.getElementById('userName').innerText = s.data().name;
                        document.getElementById('userBalance').innerText = "Rp " + (s.data().balance || 0).toLocaleString();
                    }
                });

                // Notif Dot
                onSnapshot(collection(db, "notifications"), (snap) => {
                    const lastRead = localStorage.getItem('lastReadNotif') || 0;
                    document.getElementById('notifDot').style.display = snap.size > lastRead ? 'block' : 'none';
                });

                // Preview Task Terbaru (Ambil 3 saja)
                onSnapshot(query(collection(db, "tasks"), limit(3)), (snap) => {
                    const container = document.getElementById('taskPreview');
                    container.innerHTML = "";
                    snap.forEach(d => {
                        const t = d.data();
                        container.innerHTML += `
                            <div class="preview-item">
                                <div class="task-icon"><i class="fa-solid fa-bolt"></i></div>
                                <div class="task-info">
                                    <b>${t.title}</b>
                                    <small>+ Rp ${t.reward?.toLocaleString()}</small>
                                </div>
                                <a href="submit-task.html?id=${d.id}" class="btn-go">GAS</a>
                            </div>
                        `;
                    });
                });
            } else { window.location.href = "login.html"; }
        });
    </script>
</body>
  </html>
  
